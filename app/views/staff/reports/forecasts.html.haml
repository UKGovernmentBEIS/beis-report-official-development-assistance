=content_for :page_title_prefix, t("page_title.report.forecasts",report_description: @report_presenter.description, report_financial_quarter: @report_presenter.financial_quarter_and_year)

%main.govuk-main-wrapper#main-content{ role: "main" }

  = render "staff/reports/meta"

  .govuk-grid-row
    .govuk-grid-column-full
      .govuk-tabs
        %h2.govuk-tabs__title
          Contents

        = render partial: "staff/reports/tab_list", locals: { active_tab: "forecasts" }

        .govuk-tabs__panel
          %h2.govuk-heading-l
            = t("page_content.tab_content.forecasts.heading")

          = t("page_content.tab_content.forecasts.guidance_html")

          - if policy(@report_presenter).upload?
            = link_to t("action.forecast.upload.link"), new_report_forecast_upload_path(@report_presenter), class: "govuk-button govuk-button--secondary govuk-!-margin-left-4"

          %h3.govuk-heading-m
            = t("page_content.tab_content.forecasts.per_activity_heading")

          %table.govuk-table
            %thead.govuk-table__head
              %tr.govuk-table__row
                %th.govuk-table__header{class: "govuk-!-width-one-quarter", scope: "col"} Activity
                %th.govuk-table__header{class: "govuk-!-width-one-quarter", scope: "col"} RODA Identifier
                %th.govuk-table__header.govuk-table__header--numeric{class: "govuk-!-width-one-quarter", scope: "col"} Financial Quarter
                %th.govuk-table__header.govuk-table__header--numeric{class: "govuk-!-width-one-quarter", scope: "col"} Amount
            %tbody.govuk-table__body

              - @grouped_forecasts.each do |activity_id, forecasts|
                - activity = @report_activities.find { |r| r.id == activity_id }
                - activity_presenter = ActivityPresenter.new(activity)

                %tr.govuk-table__row[activity]
                  %td.govuk-table__cell= activity_presenter.title
                  %td.govuk-table__cell= activity_presenter.roda_identifier
                  %td.govuk-table__cell{ colspan: 2 }
                    %table.govuk-table.forecasts
                      - forecasts.each do |forecast|
                        %tr.govuk-table__row
                          %td.govuk-table__cell--numeric
                            = forecast.financial_quarter_and_year
                          %td.govuk-table__cell--numeric
                            = forecast.value

              %tr.govuk-table__row.totals
                %td.govuk-table__cell{class: "govuk-!-width-one-third", scope: "col"} Total
                %td.govuk-table__cell{class: "govuk-!-width-one-quarter", scope: "col"}
                %td.govuk-table__cell
                %td.govuk-table__cell.govuk-table__cell--numeric{class: "govuk-!-width-one-quarter", scope: "col"}
                  = @total_forecast


